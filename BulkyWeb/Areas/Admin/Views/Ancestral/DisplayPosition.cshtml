@model AncestralPosition
@using System.Text.Json
@{

    var builder = WebApplication.CreateBuilder();
    ViewBag.PublishDate = builder.Configuration.GetValue<string>("PublishDate");
    ViewData["Title"] = "??????????????????????-?????????????(?????)";
    string? connectionString = builder.Configuration.GetConnectionString("DefaultConnection");

    // Auto logout settings
    float? AUTO_LOGOUT_MINUTE = builder.Configuration.GetSection("Logout_Duration:AUTO_LOGOUT_MINUTE").Get<float>();
    int? WARNING_BEFORE_LOGOUT_SECOND = builder.Configuration.GetSection("Logout_Duration:WARNING_BEFORE_LOGOUT_SECOND").Get<int>();

    // If AUTO_LOGOUT_MINUTE or WARNING_BEFORE_LOGOUT_SECOND is not set, use default values
    if (AUTO_LOGOUT_MINUTE == null || WARNING_BEFORE_LOGOUT_SECOND == null)
    {
        // Default values if not set in configuration
        AUTO_LOGOUT_MINUTE = (float?)0.5; // 30 minutes
        WARNING_BEFORE_LOGOUT_SECOND = 10; // 10 seconds
    }
    else
        // Set ViewBag for use in the view
        ViewBag.AUTO_LOGOUT_MINUTE = AUTO_LOGOUT_MINUTE;
    ViewBag.WARNING_BEFORE_LOGOUT_SECOND = WARNING_BEFORE_LOGOUT_SECOND;

    // Work_Duration is used for the duration of work in the system
    float? Work_Duration = builder.Configuration.GetSection("Work_Duration").Get<float>();
    int? WORK_WARNING_SECONDS = builder.Configuration.GetSection("WORK_WARNING_SECONDS").Get<int>();

    // If Work_Duration is not set, use default value
    if (Work_Duration == null)
    {
        // Default value if not set in configuration
        Work_Duration = (float?)1.0; // 1 mins
    }
    ViewBag.Work_Duration = Work_Duration;
    // Set ViewBag for WORK_WARNING_SECONDS for use in the view
    if (WORK_WARNING_SECONDS == null)
    {
        // Default value if not set in configuration
        WORK_WARNING_SECONDS = 60; // 60 seconds
    }
    ViewBag.WORK_WARNING_SECONDS = WORK_WARNING_SECONDS; // Default value will be null if not set
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ????CSS???? -->
    <link rel="stylesheet" href="~/css/position_Display.css" asp-append-version="true" />
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <title>????-??????</title>
</head>

<body>
    <header>
        <div id="txtblnkindex1" class="text-center fw-bolder blink">
            <p id="work_duration_top" style="font-size:larger;color:green;font-weight:bolder" class="text-bg-info align-content-center fw-bolder"></p>
        </div>
    </header>
    <a asp-action="PositionQuery" class="btn btn-outline-primary bg-gradient mb-5 fw-semibold  text-uppercase">
        <label style="font-size:30px;color:darkgreen;font-weight:bolder">????</label>
    </a>
    <h2>????-????</h2>
    <div class="card-body p-4">
        <label>??</label>
        <label id="Ancestral_Name" class="displaylabel blink_name">@Model.Name</label>
        <label id="Ancestral_PositionId" class="displaylabel blink_name">@Model.PositionId</label>
    @*     <label id="Ancestral_Applicant">???:@Model.Applicant</label> *@
        <label></label>
    </div>
    <h2> ??,??</h2>
    <div>
        <div id="RootDiv_Ancestral_layout" class="position-container-Ancestral-layout"></div>
    </div>

    <div>
        <div id="RootDiv_Ancestral_left" class="position-container-Ancestral-left"></div>
    </div>
    <div>
        <div id="RootDiv_Ancestral_right" class="position-container-Ancestral-right"></div>
    </div>

    <div id="queryModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <span class="close-btn" onclick="closeQueryModal()">&times;</span>
            <h3><span class="blink_name" id="ModalName"></span></h3>
            <h3><span class="blink_name" id="ModalPositionId"></span></h3>
            @*  <h5><span id="ModalApplicant"></span></h5>    *@     
            <div id="ModalDynamicContent">
                <!-- Dynamic content will be injected here -->
            </div>
            <!-- ...other modal content... -->
        </div>
    </div>

    @* Message Modal 2025 07 15 12:42 *@
    <div id="MseModal" class="modal-overlay" style="display:none;">
        <span class="close-btn" onclick="closeMsgModal()">&times;</span>
        <div class="modal-content yesno-modal">
            <h2 id="MsgModalTitle" class="yesno-title">????</h2>
            <p id="MsgModalMessage" class="yesno-message"></p>
        </div>
    </div>
    <h2>????????????</h2>
    <div class="col-12 text-center fw-bolder">
        <img src="~/images/Ancestral/Ancestral_layout_1.jpg" alt="????" style="max-width:100%;height:auto;" />
    </div>
    <div class="col-12 text-center fw-bolder">
        <img src="~/images/Ancestral/Ancestral_note_1.jpg" alt="???????" style="max-width:100%;height:auto;" />
    </div>
    <div class="col-12 text-center fw-bolder">
        <img src="~/images/Ancestral/Ancestral_note_0.jpg" alt="????????" style="max-width:100%;height:auto;" />
    </div>

    <div id="autoLogoutWarning">
        <div class="modal-content">
            <h4 style="color:#c0392b;">????????[????]....</h4>
            <p style="color:blue;font-size:xx-large;font-weight:bolder">????????????,?? <span style="color:red;font-size:larger" id="logoutCountdown">@ViewBag.WARNING_BEFORE_LOGOUT_SECOND</span> ????????[????](ADP)?</p>
            <button onclick="stayLoggedIn()" class="btn btn-primary">[????]</button>
        </div>
    </div>
    <button id="goTopBtn" class="btn btn-danger">????</button>
    <div id="workDurationWarning" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
        <div class="modal-content" style="background:#fff; padding:2rem 2.5rem; border-radius:10px; box-shadow:0 4px 24px rgba(0,0,0,0.18); text-align:center; max-width:90vw;">
            <p style="color:blue;font-size:xx-large;font-weight:bolder">????????????,?????? <span style="color:red;font-size:larger" id="workLogoutCountdown">@ViewBag.WORK_WARNING_SECONDS</span> ????,?????[??[????]](ADP)?</p>
        </div>
    </div>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script>


        //////////////////////////
        //0.?? ?,??,???.
        // (??) r? ?? ??
        /////////////////////////
        // ????????:?,?,?,?
        var arlayout=@Html.Raw(JsonSerializer.Serialize<object>(ViewBag.AncestralLayout_R));
         // ????????:?,?,?,?
        var allayout=@Html.Raw(JsonSerializer.Serialize<object>(ViewBag.AncestralLayout_L));
         // ????/??????:?,?,?,?,???????,?,?,?,?
        var alayout=@Html.Raw(JsonSerializer.Serialize<object>(ViewBag.AncestralLayout));

        //////////////////////////
        //?.?????????
        // (??) r? ?? ??
        /////////////////////////
        // ?? ?1?10?:
        // ?????1??????
        var ararow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow1));
        // ?????2??????
        var ararow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow2));
        // ?????3??????
        var ararow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow3));
        // ?????4??????
        var ararow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow4));
        // ?????5??????
        var ararow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow5));
        // ?????6??????
        var ararow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow6));
        // ?????7??????
        var ararow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow7));
        // ?????8??????
        var ararow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow8));
        // ?????9??????
        var ararow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow9));
        // ?????10??????
        var ararow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ararow10));

        // ?? ?1?10?:
        // ?????1??????
        var arbrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow1));
        // ?????2??????
        var arbrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow2));
        // ?????3??????
        var arbrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow3));
        // ?????4??????
        var arbrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow4));
        // ?????5??????
        var arbrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow5));
        // ?????6??????
        var arbrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow6));
        // ?????7??????
        var arbrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow7));
        // ?????8??????
        var arbrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow8));
        // ?????9??????
        var arbrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow9));
        // ?????10??????
        var arbrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arbrow10));

        // ?? ?1?10?:
        // ?????1??????
        var arcrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow1));
        // ?????2??????
        var arcrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow2));
        // ?????3??????
        var arcrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow3));
        // ?????4??????
        var arcrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow4));
        // ?????5??????
        var arcrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow5));
        // ?????6??????
        var arcrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow6));
        // ?????7??????
        var arcrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow7));
        // ?????8??????
        var arcrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow8));
        // ?????9??????
        var arcrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow9));
        // ?????10??????
        var arcrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.arcrow10));

        // ?? ?1?10?:
        // ?????1??????
        var ardrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow1));
        // ?????2??????
        var ardrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow2));
        // ?????3??????
        var ardrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow3));
        // ?????4??????
        var ardrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow4));
        // ?????5??????
        var ardrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow5));
        // ?????6??????
        var ardrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow6));
        // ?????7??????
        var ardrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow7));
        // ?????8??????
        var ardrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow8));
        // ?????9??????
        var ardrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow9));
        // ?????10??????
        var ardrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ardrow10));

        //2025 08 26 14:27
        // ?? ?? ?1?10?:
        // ?????1??????
        var armrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow1));
        // ?????2??????
        var armrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow2));
        // ?????3??????
        var armrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow3));
        // ?????4??????
        var armrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow4));
        // ?????5??????
        var armrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow5));
        // ?????6??????
        var armrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow6));
        // ?????7??????
        var armrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow7));
        // ?????8??????
        var armrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow8));
        // ?????9??????
        var armrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow9));
        // ?????10??????
        var armrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.armrow10));
         //////////////////////////
        //?.?????????
        // (??) l? ?? ??
        /////////////////////////
        // ?? ?1?10?:
        // ?????1??????
        var alarow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow1));
        // ?????2??????
        var alarow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow2));
        // ?????3??????
        var alarow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow3));
        // ?????4??????
        var alarow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow4));
        // ?????5??????
        var alarow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow5));
        // ?????6??????
        var alarow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow6));
        // ?????7??????
        var alarow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow7));
        // ?????8??????
        var alarow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow8));
        // ?????9??????
        var alarow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow9));
        // ?????10??????
        var alarow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alarow10));

        // ?? ?1?10?:
        // ?????1??????
        var albrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow1));
        // ?????2??????
        var albrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow2));
        // ?????3??????
        var albrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow3));
        // ?????4??????
        var albrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow4));
        // ?????5??????
        var albrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow5));
        // ?????6??????
        var albrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow6));
        // ?????7??????
        var albrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow7));
        // ?????8??????
        var albrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow8));
        // ?????9??????
        var albrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow9));
        // ?????10??????
        var albrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.albrow10));

        // ?? ?1?10?:
        // ?????1??????
        var alcrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow1));
        // ?????2??????
        var alcrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow2));
        // ?????3??????
        var alcrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow3));
        // ?????4??????
        var alcrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow4));
        // ?????5??????
        var alcrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow5));
        // ?????6??????
        var alcrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow6));
        // ?????7??????
        var alcrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow7));
        // ?????8??????
        var alcrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow8));
        // ?????9??????
        var alcrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow9));
        // ?????10??????
        var alcrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.alcrow10));

        // ?? ?1?10?:
        // ?????1??????
        var aldrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow1));
        // ?????2??????
        var aldrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow2));
        // ?????3??????
        var aldrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow3));
        // ?????4??????
        var aldrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow4));
        // ?????5??????
        var aldrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow5));
        // ?????6??????
        var aldrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow6));
        // ?????7??????
        var aldrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow7));
        // ?????8??????
        var aldrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow8));
        // ?????9??????
        var aldrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow9));
        // ?????10??????
        var aldrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.aldrow10));

        //2025 08 26 14:27
        // ?? ?? ?1?10?:
        // ?????1??????
        var almrow1 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow1));
        // ?????2??????
        var almrow2 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow2));
        // ?????3??????
        var almrow3 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow3));
        // ?????4??????
        var almrow4 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow4));
        // ?????5??????
        var almrow5 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow5));
        // ?????6??????
        var almrow6 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow6));
        // ?????7??????
        var almrow7 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow7));
        // ?????8??????
        var almrow8 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow8));
        // ?????9??????
        var almrow9 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow9));
        // ?????10??????
        var almrow10 = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.almrow10));

        //////////////////////////////
        // ?.????.??.????????
        /////////////////////////////

        //??,??~?? ????????
        var positionary_alaary = Array.from({ length: @(ViewBag.lar ?? 0) }, () => Array(@(ViewBag.lac ?? 0)).fill(0));
        // ?????1??????
        positionary_alaary[0] = alarow1.split(",");
        // ?????2?????
        positionary_alaary[1] = alarow2.split(",");
        // ?????3??????
        positionary_alaary[2] = alarow3.split(",");
        // ?????4??????
        positionary_alaary[3] = alarow4.split(",");
        // ?????5??????
        positionary_alaary[4] = alarow5.split(",");
        // ?????6??????
        positionary_alaary[5] = alarow6.split(",");
        // ?????7??????
        positionary_alaary[6] = alarow7.split(",");
        // ?????8??????
        positionary_alaary[7] = alarow8.split(",");
        // ?????9??????
        positionary_alaary[8] = alarow9.split(",");
        // ?????10??????
        positionary_alaary[9] = alarow10.split(",");

        //??,????????
        var positionary_albary = Array.from({ length: @(ViewBag.lbr ?? 0) }, () => Array(@(ViewBag.lbc ?? 0)).fill(0));
        // ?????1??????
        positionary_albary[0] = albrow1.split(",");
        // ?????2??????
        positionary_albary[1] = albrow2.split(",");
        // ?????3??????
        positionary_albary[2] = albrow3.split(",");
        // ?????4??????
        positionary_albary[3] = albrow4.split(",");
        // ?????5??????
        positionary_albary[4] = albrow5.split(",");
        // ?????6??????
        positionary_albary[5] = albrow6.split(",");
        // ?????7??????
        positionary_albary[6] = albrow7.split(",");
        // ?????8??????
        positionary_albary[7] = albrow8.split(",");
        // ?????9??????
        positionary_albary[8] = albrow9.split(",");
        // ?????10??????
        positionary_albary[9] = albrow10.split(",");

        //??,????????
        var positionary_alcary = Array.from({ length: @(ViewBag.lcr ?? 0) }, () => Array(@(ViewBag.lcc ?? 0)).fill(0));
        // ?????1??????
        positionary_alcary[0] = alcrow1.split(",");
        // ?????2??????
        positionary_alcary[1] = alcrow2.split(",");
        // ?????3??????
        positionary_alcary[2] = alcrow3.split(",");
        // ?????4??????
        positionary_alcary[3] = alcrow4.split(",");
        // ?????5??????
        positionary_alcary[4] = alcrow5.split(",");
        // ?????6??????
        positionary_alcary[5] = alcrow6.split(",");
        // ?????7??????
        positionary_alcary[6] = alcrow7.split(",");
        // ?????8??????
        positionary_alcary[7] = alcrow8.split(",");
        // ?????9??????
        positionary_alcary[8] = alcrow9.split(",");
        // ?????10??????
        positionary_alcary[9] = alcrow10.split(",");

        //??,????????
        var positionary_aldary = Array.from({ length: @(ViewBag.ldr ?? 0) }, () => Array(@(ViewBag.ldc ?? 0)).fill(0));
        // ?????1??????
        positionary_aldary[0] = aldrow1.split(",");
        // ?????2??????
        positionary_aldary[1] = aldrow2.split(",");
        // ?????3??????
        positionary_aldary[2] = aldrow3.split(",");
        // ?????4??????
        positionary_aldary[3] = aldrow4.split(",");
        // ?????5??????
        positionary_aldary[4] = aldrow5.split(",");
        // ?????6??????
        positionary_aldary[5] = aldrow6.split(",");
        // ?????7??????
        positionary_aldary[6] = aldrow7.split(",");
        // ?????8??????
        positionary_aldary[7] = aldrow8.split(",");
        // ?????9??????
        positionary_aldary[8] = aldrow9.split(",");
        // ?????10??????
        positionary_aldary[9] = aldrow10.split(",");

        //2025 08 26 14:28
        //?? ??,????????
        var positionary_almary = Array.from({ length: @(ViewBag.lmr ?? 0) }, () => Array(@(ViewBag.lmc ?? 0)).fill(0));
        // ?????1??????
        positionary_almary[0] = almrow1.split(",");
        // ?????2??????
        positionary_almary[1] = almrow2.split(",");
        // ?????3??????
        positionary_almary[2] = almrow3.split(",");
        // ?????4??????
        positionary_almary[3] = almrow4.split(",");
        // ?????5??????
        positionary_almary[4] = almrow5.split(",");
        // ?????6??????
        positionary_almary[5] = almrow6.split(",");
        // ?????7??????
        positionary_almary[6] = almrow7.split(",");
        // ?????8??????
        positionary_almary[7] = almrow8.split(",");
        // ?????9??????
        positionary_almary[8] = almrow9.split(",");
        // ?????10??????
        positionary_almary[9] = almrow10.split(",");

       //??,??~?? ????????
       var positionary_araary = Array.from({ length: @(ViewBag.rar ?? 0) }, () => Array(@(ViewBag.rac ?? 0)).fill(0));

        // ?????1??????
        positionary_araary[0] = ararow1.split(",");
        // ?????2??????
        positionary_araary[1] = ararow2.split(",");
        // ?????3??????
        positionary_araary[2] = ararow3.split(",");
        // ?????4??????
        positionary_araary[3] = ararow4.split(",");
        // ?????5??????
        positionary_araary[4] = ararow5.split(",");
        // ?????6??????
        positionary_araary[5] = ararow6.split(",");
        // ?????7??????
        positionary_araary[6] = ararow7.split(",");
        // ?????8??????
        positionary_araary[7] = ararow8.split(",");
        // ?????9??????
        positionary_araary[8] = ararow9.split(",");
        // ?????10??????
        positionary_araary[9] = ararow10.split(",");

        //??,????????
        var positionary_arbary = Array.from({ length: @(ViewBag.rbr ?? 0) }, () => Array(@(ViewBag.rbc ?? 0)).fill(0));

        // ?????1??????
        positionary_arbary[0] = arbrow1.split(",");
        // ?????2??????
        positionary_arbary[1] = arbrow2.split(",");
        // ?????3??????
        positionary_arbary[2] = arbrow3.split(",");
        // ?????4??????
        positionary_arbary[3] = arbrow4.split(",");
        // ?????5??????
        positionary_arbary[4] = arbrow5.split(",");
        // ?????6??????
        positionary_arbary[5] = arbrow6.split(",");
        // ?????7??????
        positionary_arbary[6] = arbrow7.split(",");
        // ?????8??????
        positionary_arbary[7] = arbrow8.split(",");
        // ?????9??????
        positionary_arbary[8] = arbrow9.split(",");
        // ?????10??????
        positionary_arbary[9] = arbrow10.split(",");

        //??,????????
        var positionary_arcary = Array.from({ length: @(ViewBag.rcr ?? 0) }, () => Array(@(ViewBag.rcc ?? 0)).fill(0));
        // ?????1??????
        positionary_arcary[0] = arcrow1.split(",");
        // ?????2??????
        positionary_arcary[1] = arcrow2.split(",");
        // ?????3??????
        positionary_arcary[2] = arcrow3.split(",");
        // ?????4??????
        positionary_arcary[3] = arcrow4.split(",");
        // ?????5??????
        positionary_arcary[4] = arcrow5.split(",");
        // ?????6??????
        positionary_arcary[5] = arcrow6.split(",");
        // ?????7??????
        positionary_arcary[6] = arcrow7.split(",");
        // ?????8??????
        positionary_arcary[7] = arcrow8.split(",");
        // ?????9??????
        positionary_arcary[8] = arcrow9.split(",");
        // ?????10??????
        positionary_arcary[9] = arcrow10.split(",");

        //??,????????
        var positionary_ardary = Array.from({ length: @(ViewBag.rdr ?? 0) }, () => Array(@(ViewBag.rdc ?? 0)).fill(0));
        // ?????1??????
        positionary_ardary[0] = ardrow1.split(",");
        // ?????2??????
        positionary_ardary[1] = ardrow2.split(",");
        // ?????3??????
        positionary_ardary[2] = ardrow3.split(",");
        // ?????4??????
        positionary_ardary[3] = ardrow4.split(",");
        // ?????5??????
        positionary_ardary[4] = ardrow5.split(",");
        // ?????6??????
        positionary_ardary[5] = ardrow6.split(",");
        // ?????7??????
        positionary_ardary[6] = ardrow7.split(",");
        // ?????8??????
        positionary_ardary[7] = ardrow8.split(",");
        // ?????9??????
        positionary_ardary[8] = ardrow9.split(",");
        // ?????10??????
        positionary_ardary[9] = ardrow10.split(",");

        //2025 08 26 14:28
        //?? ??,????????
        var positionary_armary = Array.from({ length: @(ViewBag.rmr ?? 0) }, () => Array(@(ViewBag.rmc ?? 0)).fill(0));
        // ?????1??????
        positionary_armary[0] = armrow1.split(",");
        // ?????2??????
        positionary_armary[1] = armrow2.split(",");
        // ?????3??????
        positionary_armary[2] = armrow3.split(",");
        // ?????4??????
        positionary_armary[3] = armrow4.split(",");
        // ?????5??????
        positionary_armary[4] = armrow5.split(",");
        // ?????6??????
        positionary_armary[5] = armrow6.split(",");
        // ?????7??????
        positionary_armary[6] = armrow7.split(",");
        // ?????8??????
        positionary_armary[7] = armrow8.split(",");
        // ?????9??????
        positionary_armary[8] = armrow9.split(",");
        // ?????10??????
        positionary_armary[9] = armrow10.split(",");


         // ???,,? ????? 2025 07 12 13:14
        var alayout_ary = Array.from({ length: @(ViewBag.AncestralSide ?? 0) }, () => Array(@(ViewBag.AncestralSection ?? 0)).fill(0));
         // ???? ????? 2025 07 12 13:14
        alayout_ary[0] = allayout.split(",");
         // ???? ????? 2025 07 12 13:14
        alayout_ary[1] = arlayout.split(",");

         // ???,,? ????? 2025 07 12 13:14
        var alayout_ary = Array.from({ length: @(ViewBag.AncestralSide - 1 ?? 0) }, () => Array(@(ViewBag.AncestralSection * 2 ?? 0)).fill(0));
         // ???? ????? 2025 07 12 13:14
        alayout_ary[0] = alayout.split(",");

        ////////////////////////////
        //?.?????
        ///////////////////////////

        /////////////////////////
        //??, ??~?? ????
        /////////////////////////

              /////////////////////////
        //??, ??~?? ????
        /////////////////////////
        //(1)??,????
        // l:?? // ?? // ??// ??// ??
        //===============
        // r:?? // ?? // ?? // ?? //??

         //2025 08 26 14:28
         // ????-????:
        var desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_left",positionary_almary,desc,'levelleft','positionAncestral');

        // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_left",positionary_alaary,desc,'levelleft','positionAncestral');

         // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_left",positionary_albary,desc,'levelleft','positionAncestral');

          // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_left",positionary_alcary,desc,'levelleft','positionAncestral');


        // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_left",positionary_aldary,desc,'levelleft','positionAncestral');

        /////////////////////////
        //??, ??~?? ????
        /////////////////////////
        //2025 08 26 14:28
        // ????-????:
        var desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_right",positionary_armary,desc,'levelleft','positionAncestral')

        // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_right",positionary_araary,desc,'levelright','positionAncestral');

        // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_right",positionary_arbary,desc,'levelright','positionAncestral');

        // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_right",positionary_arcary,desc,'levelright','positionAncestral');

        // ????????:
        desc="??-??-";
        renderPositionRows("RootDiv_Ancestral_right",positionary_ardary, desc,'levelright','positionAncestral');


         // ??:???????????????(????,????)
        // ??:positionary_asideary ??,????
         function renderLayoutSideSection(root_div,positionary_asideary,desc,levelClassName,positionClassName)
        {
               // alert('desc : '+desc);
               // alert('root_div : '+root_div);
               // alert('positionary_asideary : '+positionary_asideary);
               // alert('levelClassName : '+levelClassName);
            let sideDiv= document.createElement('div');
               // ??class?row
            sideDiv.className = 'row';
            for (let i =0; i <= positionary_asideary.length-1 ; i++) {
                    //??
                    let  section = positionary_asideary[i];
                    // ????span????????
                    let SectionSpan = document.createElement('span');
                    SectionSpan.readOnly = true //????
                    SectionSpan.innerText = section;   // ??:?? eg: ?: ?,?,?,? /  ?: ?,?,?,?
                    SectionSpan.className = positionClassName; // ??class????position
                    // ???span?????rowDiv?
                    sideDiv.appendChild(SectionSpan);
                }
                // ????span??????????? desc
                    // let descSpan = document.createElement('span');
                    // descSpan.readOnly = true //????
                    // descSpan.className = levelClassName; // ??class?classname
                    // descSpan.innerText = desc; // ???????????
                     // Add the span to the sideDiv
                     // ???descSpan?????sideDiv?
                    //sideDiv.appendChild(descSpan);
                // Add the row div to the container
                // ?????div???RootDiv_Kindness?
                document.getElementById(root_div).appendChild(sideDiv);
         }

        // ??:??????????????(????,??,?,???)
        // ??:positionary_asideary ??,??,?,????
         function renderPositionRows(root_div,positionary_asideary,desc,levelClassName,positionClassName) {
            //Get each Row ID
            let rowId = "";
            for (let i =0; i <= positionary_asideary.length-1 ; i++) {
                //Get each Row ID
                rowId = (i+1)
                // Get each row of position IDs
                // ??????????
                let row = positionary_asideary[i];
                // Create a div for the row
                // ????div????????
                let rowDiv = document.createElement('div');
                // ??class?row
                rowDiv.className = 'row';
                for (let j=0; j <= row.length-1;j++) {
                    // Get each position ID
                    // ?????????
                    let position=row[j]; //????
                    let positionId = desc+rowId+"?:" + position;  //eg:??-??-7:34  format:?-?-?:?
                    // Create a span for the position
                    // ????span?????????
                    let positionSpan = document.createElement('span');
                    positionSpan.readOnly = true //????
                    if (position==="000")
                    {
                           positionSpan.className = 'position_window_door'; // ?/???,???
                           positionSpan.innerText = '???-???';   // ??:??'?/???,???'
                    }
                    else
                    {
                           positionSpan.className = positionClassName; // ??class????position
                           positionSpan.innerText = positionId; // ???????????
                    }

                    // Add the span to the row div
                    // ???span?????rowDiv?
                    rowDiv.appendChild(positionSpan);
                }
                // ????span??????????? desc
                    let positionSpan = document.createElement('span');
                    positionSpan.readOnly = true //????
                    positionSpan.className = levelClassName; // ??class?classname
                    positionSpan.innerText = desc.replace("\n","") +(i+1)+"?"; // ???????????
                     // Add the span to the row div
                    // ???span?????rowDiv?
                    rowDiv.appendChild(positionSpan);
                // Add the row div to the container
                // ?????div???RootDiv_Kindness?
                document.getElementById(root_div).appendChild(rowDiv);
            }
        }


          //(1) find the Section for the wanted clan
        function populateSectionUI() {

            const positions = document.querySelectorAll('.sectionAncestral');
            var section = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.section)); //??????
            //alert('section: '+section);
                if(section.length > 0) {
                    positions.forEach(position => {
                        var  bool_result= (section+"?")==position.innerText;;//?? ===??
                        //alert('bool_result: ' +bool_result);
                        if (bool_result) {
                            position.classList.add('Ancestralsectioncurrent');//??????'Ancestralsectioncurrent'
                            position.classList.add('blink'); // ?? 2025 07 30 23:42
                            //position.innerText += ('-'+ @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.PositionId))); //???????
                            }
                    });
                    }
                }


         //(1) populate position from Database to UI  sectionAncestral
        function populateUI() {

            const positions = document.querySelectorAll('.positionAncestral');
            //alert('positions.length: '+positions.length);

                //???????????? ViewBag.ListPositionId
            var listPositionId = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.ListPositionId));
            //alert('listPositionId.length: '+listPositionId.length);
                if(listPositionId.length > 0) {
                    //alert('kind==1');
                    //alert('ListPositionId: ' + JSON.stringify(listPositionId));
                    positions.forEach(position => {
                        listPositionId.forEach(positionid => {  //???? //positionid  eg: '1?-??-7?-234,??1'
                        var  Local_positionid=position.innerText;
                        //alert('Local_positionid: ' +Local_positionid);//???? eg: '1?-??-7?-234'
                        var  positionId_compared=positionid.substr(0,positionid.indexOf(","));  // ????[?]???:??
                        //alert('positionId_compared: ' +positionId_compared);
                        var  name=positionid.substr(positionid.indexOf(",")+1);  // ????[?]???:????
                        //alert('name: ' +name);
                        var  bool_result=positionId_compared===Local_positionid;//?? ===??
                        //alert('bool_result: ' +bool_result);
                          //???????
                        var currentPositonId=  @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.PositionId));
                        if (bool_result) {
                            position.classList.add('occupied');//????????
                            position.innerText += ('-'+ name);
                             if (currentPositonId === Local_positionid) //???????
                              {
                                 position.classList.add('current');//??????????
                                 position.classList.add('blink');// ?? ??????? 2025 07 31 23:57
                                 var  sideSectionLevel=positionid.substr(0,positionid.indexOf(":"));  // ??[:][?]???:??-??-??
                                 //alert('sideSectionLevel'+sideSectionLevel);
                                 var targetSpan = findSpanByInnerText(sideSectionLevel);
                                     if (targetSpan) {
                                         targetSpan.classList.add('blink');// ?? ????????'??-??-??' 2025 07 31 23:57
                                    }
                              }
                            }
                        });
                    });
                }
       }


       function findSpanByInnerText(sideSectionLevel) {
        // 2025 08 01 00:18 Get all spans (or use a more specific selector if needed)
        const spans = document.querySelectorAll('span');
        // Find the first span whose innerText matches floorSectionLevel exactly
        for (let span of spans) {
            if (span.innerText.trim() === sideSectionLevel.trim()) {
                return span;
            }
        }
        return null; // Not found
       }

          //?,????
        function filterPositionsBySideAndSection(side, section) {
        // Normalize for "??"
        const allSides = (side === "0");
        const allSections = (section === "0");

        // Build label for matching
        const sideLabel = allSides ? "" : side + "?";
        const sectionLabel = allSections ? "" : section + "?";

         // 2025 07 15 01:43 Count right side positions fitted to [sideLabel] && [sectionLabel]:
            var PositionsFitted_count=0;
            const positions = document.querySelectorAll('.positionAncestral');
            positions.forEach(position=>{
                const descText = position.innerText;
                const sideMatch = allSides || descText.startsWith(sideLabel);
                const sectionMatch = allSections || descText.includes(sectionLabel);
                if(sideMatch && sectionMatch)
                {
                    PositionsFitted_count++;
                }
             });
             //alert('PositionsFitted_count:'+PositionsFitted_count);
            // Count right side positions fitted to [sideLabel] && [sectionLabel]:

            if (PositionsFitted_count==0)
            {
               openMsgModal("???:["+ side +"]????["+section+"]?,??????! ?:(1)??:??,??,??,??,??"+
                "(2)??:??,??,??,??,?? " );
                // 2025 07 15 09:31 make Button 'displayWantedSideSecBtn' invisible
                document.getElementById('displayWantedSideSecBtn').style.display = 'none';
            }
            else
            {
                // Filter left side
                document.querySelectorAll('#RootDiv_Ancestral_left .row').forEach(row => {
                    const descSpan = row.querySelector('span:last-child');
                    if (!descSpan) {
                        row.style.display = 'none';
                        return;
                    }
                    const descText = descSpan.innerText;
                    const sideMatch = allSides || descText.startsWith(sideLabel);
                    const sectionMatch = allSections || descText.includes(sectionLabel);
                    row.style.display = (sideMatch && sectionMatch) ? '' : 'none';
                });

                // Filter right side
                document.querySelectorAll('#RootDiv_Ancestral_right .row').forEach(row => {
                    const descSpan = row.querySelector('span:last-child');
                    if (!descSpan) {
                        row.style.display = 'none';
                        return;
                    }
                    const descText = descSpan.innerText;
                    const sideMatch = allSides || descText.startsWith(sideLabel);
                    const sectionMatch = allSections || descText.includes(sectionLabel);
                    row.style.display = (sideMatch && sectionMatch) ? '' : 'none';
                });

                   // ??????:
                desc="??-??,??";
                renderLayoutSideSection("RootDiv_Ancestral_layout", alayout_ary[0],desc,'levelleft','sectionAncestral');

                /*2025 07 18 15:13 Make ????? Higher than others*/
                MakeFirstClanHigher();

                //alert(displayed_positionid)
                //Dispaly wanted side &section info
                openQueryModalWithData();
        }
    }

     //?????????;

     let side = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.side));
     let section = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.section));
     filterPositionsBySideAndSection(side, section);

      //??????????
      populateUI();
      //?????? (???????,??,????????!!)

      //(1) find the Section for the wanted clan
      populateSectionUI();

      //Display Result onto a Modal windows 2025 07 11 16:01

        function openQueryModalWithData() {
        var displayed_section = document.getElementById('RootDiv_Ancestral_layout').innerHTML;
          //????
        var name = document.getElementById('Ancestral_Name').innerHTML;
        var positionId = document.getElementById('Ancestral_PositionId').innerHTML;
        //var applicant=document.getElementById('Ancestral_Applicant').innerHTML;
        //var cyfiedName = name.substr(0,1)+"*"+name.substr(2,10);
        //Example: data could be an object or string
        document.getElementById('ModalDynamicContent').innerHTML =
            `<p style="text-align:center">${displayed_section}</p>`;
        document.getElementById('ModalName').innerHTML =
            `<p style="font-size:30px;font-weight:bolder">${name}</p>`;
        document.getElementById('ModalPositionId').innerHTML =
            `<p style="font-size:30px;font-weight:bolder">${positionId}</p>`;
        // document.getElementById('ModalApplicant').innerHTML =
        //     `<p style="font-size:10px;font-weight:bolder">${applicant}</p>`;
        //visable: block
        document.getElementById('queryModal').style.display = 'block';
    }
        function closeQueryModal() {
        //invisable: none
        document.getElementById('queryModal').style.display = 'none';
    }

    //2025 07 15 09:18 open Message Modal
    function openMsgModal(message) {
        document.getElementById('MsgModalMessage').innerText = message;
        document.getElementById('MseModal').style.display = 'flex';
    }

    //2025 07 15 09:18 close Message Modal
    function closeMsgModal() {
        document.getElementById('MseModal').style.display = 'none';
    }



    /*2025 07 18 11:25 Make ????? Higher than others*/
    function MakeFirstClanHigher() {
        const container = document.getElementById('RootDiv_Ancestral_layout');
        const spans = container.querySelectorAll('span');
        spans.forEach(span => {
            if (span.innerText.trim() === "??") {   //?????-->??   2025 08 26 16:36
                // Found!
                span.classList.add('position-ancestor-layout');
                //span.classList.add('blink_firstMan'); // ?? 2025 07 31 00:01
            }
        });
    }

      // Keyboard shortcuts
    document.addEventListener('keydown', function (e) {
        if (e.key === 'T' || e.key === 't') {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        if (e.key === 'B' || e.key === 'b') {
            e.preventDefault();
            window.history.back();
        }
    });
    // document.addEventListener('keydown', function (e) {
    //     if (e.key === 'F1' || e.key === 'Q' || e.key === 'q') {
    //         e.preventDefault();
    //         openQueryModal();
    //     }
    // });
    // document.addEventListener('keydown', function (e) {
    //     if (e.key === 'S' || e.key === 's') {
    //         e.preventDefault();
    //         openYesNoModal();
    //     }
    // });

    // Go to Top button logic
    const goTopBtn = document.getElementById('goTopBtn');
    window.addEventListener('scroll', function () {
        goTopBtn.style.display = window.scrollY > 200 ? 'block' : 'block';
    });
    goTopBtn.addEventListener('click', function () {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

</script>

<script type="text/javascript">
    window.AUTO_LOGOUT_MINUTES = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.AUTO_LOGOUT_MINUTE));
    window.WARNING_BEFORE_LOGOUT_SECONDS = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.WARNING_BEFORE_LOGOUT_SECOND));
    window.WORK_DURATION_MINUTES = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.Work_Duration));
    window.WORK_WARNING_SECONDS = @Html.Raw(JsonSerializer.Serialize<object>(ViewBag.WORK_WARNING_SECONDS));
</script>
<script src="~/js/AutoLogout.js" asp-append-version="true"></script>
